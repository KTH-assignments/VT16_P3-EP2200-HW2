a)
\begin{figure}[H]
	\centering
	\scalebox{0.8}{\input{./figures/4.1.tex}}
	\caption{The block diagram of the queue. There are infinite places in the
    queue and only one server.}
\end{figure}

\begin{figure}[H]
	\centering
	\scalebox{1}{\input{./figures/4.2.tex}}
	\caption{The Markovian chain describing the system}
\end{figure}

b)
A state is defined by the number of packets in the system. Considering local
balance equations we get

\begin{align*}
  \lambda \pi_0 &= \mu \pi_1 \Leftrightarrow \pi_1 = \dfrac{\lambda}{\mu}\pi_0\\
  \lambda \pi_1 &= \mu \pi_2 \Leftrightarrow \pi_2 = \dfrac{\lambda}{\mu}\pi_1 = \Big(\dfrac{\lambda}{\mu}\Big)^2\pi_0\\
  \lambda \pi_2 &= \mu \pi_3 \Leftrightarrow \pi_3 = \Big(\dfrac{\lambda}{\mu}\Big)^3\pi_0\\
  \cdots
\end{align*}

In other words, in general $$\pi_i = \Big(\dfrac{\lambda}{\mu}\Big)^i\pi_0$$

In order to identify all $\pi_i$ we resort to the general law of
$$\sum_{i=0}^{\infty} \pi_i = 1$$

from where we calculate that
$$\pi_0 = 1 - \dfrac{\lambda}{\mu}$$

and

$$\pi_i = \Big(\dfrac{\lambda}{\mu}\Big)^i(1 - \dfrac{\lambda}{\mu})$$

The values for the intensities $\lambda$ and $\mu$ can be derived from

\begin{align*}
  \lambda &= \dfrac{1}{2 \cdot 10^{-3}} = 500 \\
  \mu     &= \dfrac{1}{10^{-3}} = 1000
\end{align*}

Hence the probability that the system is empty is given by

$$\pi_0 = 1 - \dfrac{\lambda}{\mu} = 0.5$$

and, in general, the probability that there are $i$ packets in the system
(in the queue and in the server) is

$$\pi_i = \Big(\dfrac{\lambda}{\mu}\Big)^i(1 - \dfrac{\lambda}{\mu}) = 0.5^{i+1}$$


The average number of packets waiting for transmission $N_q$ is the average
number of packets in the queue, which is

\begin{equation}
  N_q = N - N_s
  \label{eq:4.1}
\end{equation}

where $N$ is the average number of packets in the system, and $N_s$ is the
average number of packets being transmitted. Hence, finding $N_q$ means finding
$N$ and $N_s$.

The average number of packets in the system is defined as

\begin{align*}
  N &= \sum_{i=0}^{\infty} i \cdot \pi_i = \sum_{i=0}^{\infty} i \Big(\dfrac{\lambda}{\mu}\Big)^i \pi_0 =
  \pi_0 \sum_{i=0}^{\infty} i \Big(\dfrac{\lambda}{\mu}\Big)^i \\
  ~ &= \pi_0 \Big(\dfrac{\lambda}{\mu}\Big) \sum_{i=0}^{\infty} i \Big(\dfrac{\lambda}{\mu}\Big)^{i-1} =
  \pi_0 \rho \sum_{i=0}^{\infty} i \rho^{i-1} \\
  ~ &= \pi_0 \rho \sum_{i=0}^{\infty} \dfrac{d(\rho^i)}{d\rho} = \pi_0 \rho \dfrac{d}{d\rho} \Big(\sum_{i=0}^{\infty} \rho^i \Big) \\
  ~ &= \pi_0 \rho \dfrac{d}{d\rho} \Big(\dfrac{1}{1-\rho}\Big) = (1-\rho) \rho \dfrac{1}{(1-\rho)^2} = \dfrac{\rho}{1-\rho} \\
  ~ &= \dfrac{\lambda}{\mu - \lambda} = \dfrac{500}{1000-500} = 1\ \text{packet}
\end{align*}

The average number of packets under transmission is
$$N_s = \dfrac{\lambda}{\mu} = \dfrac{500}{1000} = 0.5\ \text{packets}$$

Hence, from equation \ref{eq:4.1}:

$$N_q = 1 - 0.5 = 0.5\ \text{packets}$$

c)
The probability of at least $n$ packets existing in the system is equivalent to
that of 1 minus the probability of $n-1$ existing in the system at most:
$$P(k \geq n) = 1 - P(k < n) = 1 - P(k \leq n-1)$$

But
\begin{align*}
  P(k \leq n-1) &= \sum_{k=0}^{n-1} \pi_i = \sum_{k=0}^{n-1} (1-\dfrac{\lambda}{\mu})\Big(\dfrac{\lambda}{\mu}\Big)^k \\
  ~             &= (1-\dfrac{\lambda}{\mu})\sum_{k=0}^{n-1} \Big(\dfrac{\lambda}{\mu}\Big)^k =
                   (1-\dfrac{\lambda}{\mu}) \dfrac{1-\Big(\dfrac{\lambda}{\mu}\Big)^n}{1-\dfrac{\lambda}{\mu}} \\
  ~             &= 1-\Big(\dfrac{\lambda}{\mu}\Big)^n
\end{align*}

Hence
$$P(k \geq n) = 1 - P(k \leq n-1) = \Big(\dfrac{\lambda}{\mu}\Big)^n = 0.5^n$$
